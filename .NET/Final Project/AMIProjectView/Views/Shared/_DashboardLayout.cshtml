@{
    var isUser = User.HasClaim(c => c.Type == "UserType" && c.Value == "User");
    var isConsumer = User.HasClaim(c => c.Type == "UserType" && c.Value == "Consumer");
    var controller = (string?)ViewContext.RouteData.Values["controller"];
    var action = (string?)ViewContext.RouteData.Values["action"];

    bool onMeterIndex = controller == "Meter" && (action == "Index" || action == "Create" || action == "Edit");
    bool onMeterUpload = controller == "Meter" && action == "Upload";

    // Helper for Consumer section active links
    bool onConsumerHome = controller == "Consumer" && action == "Index";
    bool onConsumerMeters = controller == "Consumer" && action == "Meters";
    bool onConsumerBills = controller == "Consumer" && action == "Bills";
    bool onConsumerConsumption = controller == "Consumer" && action == "Consumption";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - AMI_project_1</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="~/css/site.css" />
    <style>
        :root {
            --brand: #7c0a2e; /* Deep maroon/red for brand consistency */
            --sidebar: #121820; /* Dark, professional sidebar background */
            --sidebar-accent: #1a2430; /* Slightly lighter dark shade for hover */
        }

        body {
            background: #f6f7fb; /* Light, clean background */
        }

        .topbar {
            background: var(--brand);
            color: #fff;
            height: 56px;
            display: flex;
            align-items: center;
            padding: 0 .75rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 6px rgba(0,0,0,.2);
        }

            .topbar .brand {
                font-weight: 700;
                margin-right: 1rem;
                display: flex;
                align-items: center;
                gap: .5rem;
            }

        .layout {
            display: flex;
            min-height: calc(100vh - 56px);
        }

        .sidebar {
            width: 210px; /* REDUCED WIDTH (was 240px) */
            background: var(--sidebar);
            color: #cfd8e3;
            padding: .5rem 0; /* Adjusted vertical padding */
            position: sticky;
            top: 56px;
            height: calc(100vh - 56px);
            overflow-y: auto;
        }

            .sidebar .nav-link {
                color: #cfd8e3;
                padding: .5rem 1rem; /* Adjusted padding for tighter alignment */
                display: flex;
                align-items: center;
                gap: .6rem;
                border-left: 3px solid transparent;
                transition: background-color 0.2s, color 0.2s; /* Added smooth transition */
            }

                .sidebar .nav-link.active, .sidebar .nav-link:hover {
                    background: var(--sidebar-accent);
                    color: #fff;
                    border-left-color: #ffc107; /* Bright gold accent for active/hover */
                }

        .content {
            flex: 1;
            padding: 1.2rem 1.6rem;
        }

        .card {
            border: none;
            box-shadow: 0 1px 4px rgba(0,0,0,.08); /* Subtle card lift */
            border-radius: 14px;
        }

        .card-body {
            padding: 1.5rem; /* Explicit card padding */
        }

        .table thead th {
            background: #f1f3f7; /* Light grey header for tables */
        }

        /* Improved Brand Button Styling */
        .btn-brand {
            background: var(--brand) !important;
            color: #fff !important;
            border-color: var(--brand) !important;
        }

            .btn-brand:hover {
                background: #9d1341 !important; /* Slightly darker hover color */
                border-color: #9d1341 !important;
            }

        .searchbox {
            max-width: 520px;
            width: 100%;
        }
    </style>
</head>
<body>

    <header class="topbar">
        <div class="brand">
            <i class="bi bi-house-door-fill me-2"></i> <span>AMI_project_1</span>
        </div>

        <form class="d-none d-md-flex ms-2 searchbox" role="search" onsubmit="return false;">
            <input class="form-control" type="search" placeholder="Search..." aria-label="Search">
            <button class="btn btn-light ms-2" type="button"><i class="bi bi-search"></i></button>
        </form>

        <div class="ms-auto d-flex align-items-center gap-2">
            <span class="text-white-50 d-none d-sm-inline">Hello, @User.Identity?.Name</span>
            <form asp-controller="Account" asp-action="Logout" method="post" class="mb-0">
                <button type="submit" class="btn btn-outline-light btn-sm"><i class="bi bi-box-arrow-right me-1"></i> Logout</button>
            </form>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar">
            <nav class="nav flex-column">
                @if (isUser)
                {
                    <a class="nav-link @(controller == "Home" ? "active" : "")" href="/Home/Index"><i class="bi bi-speedometer2"></i> Dashboard</a>

                    <a class="nav-link @(onMeterIndex ? "active" : "")"
                       href="/Meter/Index">
                        <i class="bi bi-speedometer"></i> Meter
                    </a>

                    <a class="nav-link @(onMeterUpload ? "active" : "")"
                       href="/Meter/Upload">
                        <i class="bi bi-upload"></i> uploadmeter
                    </a>

                    <a class="nav-link @(controller == "Consumers" ? "active" : "")" href="/Consumers/Index"><i class="bi bi-person-badge"></i> Consumer</a>
                    <a class="nav-link @(controller == "OrgUnit" ? "active" : "")" href="/OrgUnit/Index"><i class="bi bi-diagram-3"></i> Org Unit</a>
                    <a class="nav-link @(controller == "Tariff" ? "active" : "")" href="/Tariff/Index"><i class="bi bi-coin"></i> Tariff</a>
                    <a class="nav-link @(controller == "TariffSlabs" ? "active" : "")" href="/TariffSlabs/Index"><i class="bi bi-grid-1x2"></i> Tariff Slabs</a>
                    <a class="nav-link @(controller == "TodRules" ? "active" : "")" href="/TodRules/Index"><i class="bi bi-clock-history"></i> TOD Rules</a>
                    <a class="nav-link @(controller == "Bills" ? "active" : "")" href="/Bills/Index"><i class="bi bi-receipt"></i> Bills</a>
                    <a class="nav-link @(controller == "Users" ? "active" : "")" href="/Users/Index"><i class="bi bi-people"></i> Users</a>
                }
                @if (isConsumer)
                {
                    <a class="nav-link @(onConsumerHome ? "active" : "")" href="/Consumer/Index"><i class="bi bi-house-door"></i> Home</a>
                    <a class="nav-link @(onConsumerMeters ? "active" : "")" href="/Consumer/Meters"><i class="bi bi-speedometer"></i> My Meters</a>
                    <a class="nav-link @(onConsumerBills ? "active" : "")" href="/Consumer/Bills"><i class="bi bi-receipt"></i> Bills</a>
                    <a class="nav-link @(onConsumerConsumption ? "active" : "")" href="/Consumer/Consumption"><i class="bi bi-graph-up-arrow"></i> Consumption</a>
                }
            </nav>
        </aside>

        <main class="content">
            @RenderBody()
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>