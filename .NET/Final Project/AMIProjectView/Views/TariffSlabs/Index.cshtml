@model List<AMIProjectView.Models.TariffSlabVm>
@using AMIProjectView.Controllers
@{
    Layout = "_DashboardLayout";
    ViewData["Title"] = "Tariff Slab Data";
    var tariffs = (List<TariffVm>)ViewBag.Tariffs;
    int? selected = ViewBag.SelectedTariffId as int?;
}
<div class="card p-4">
    <div class="d-flex align-items-center mb-3">
        <h4 class="mb-0"><i class="bi bi-bar-chart-steps"></i> Tariff Slab Data</h4>
    </div>

    @if (TempData["ok"] != null)
    {
        <div class="alert alert-success">@TempData["ok"]</div>
    }
    @if (TempData["err"] != null)
    {
        <div class="alert alert-danger">@TempData["err"]</div>
    }

    <div class="mb-3" style="max-width:360px">
        <label class="form-label">Select Tariff:</label>

        <select class="form-select"
                onchange="window.location.href='@Url.Action("Index", "TariffSlabs")?tariffId=' + this.value;">
            <option value="">-- Select a Tariff --</option>
            @foreach (var t in tariffs)
            {
                <option value="@t.TariffId"
                        selected="@(selected.HasValue && selected.Value == t.TariffId)">
                    @t.TariffName
                </option>
            }
        </select>
    </div>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>Slab ID</th>
                    <th>From (kWh)</th>
                    <th>To (kWh)</th>
                    <th>Rate per kWh</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (selected.HasValue && Model.Any())
                {
                    foreach (var s in Model)
                    {
                        <tr>
                            <td>@s.SlabId</td>
                            <td>@s.FromKwh</td>
                            <td>@s.ToKwh</td>
                            <td>@s.RatePerKwh</td>
                            <td class="text-end">
                                <a asp-action="Edit" asp-route-id="@s.SlabId" class="btn btn-sm btn-primary">Edit</a>
                                @* Delete removed from UI (server still supports it) *@
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr><td colspan="4" class="text-muted">Please select a tariff to load slabs...</td></tr>
                }
            </tbody>
        </table>
    </div>

    @if (selected.HasValue)
    {
        <div class="border rounded p-3 mt-3 bg-white" style="max-width:780px">
            <h6 class="mb-3">Add Slab</h6>
            <form asp-action="Add" method="post" class="row g-3">
                @Html.AntiForgeryToken()

                @* IMPORTANT: hidden field name must match the VM property (TariffId) *@
                <input type="hidden" name="TariffId" value="@selected" />

                <div class="col-md-3">
                    <label class="form-label">From (kWh)</label>
                    <input name="FromKwh" type="number" step="0.000001" class="form-control" required />
                </div>
                <div class="col-md-3">
                    <label class="form-label">To (kWh)</label>
                    <input name="ToKwh" type="number" step="0.000001" class="form-control" required />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Rate per kWh</label>
                    <input name="RatePerKwh" type="number" step="0.000001" class="form-control" required />
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-success"><i class="bi bi-plus-lg"></i> Add</button>
                </div>
            </form>
        </div>
    }
</div>
